# GOGOEV 故障・メンテナンス情報自動収集スクリプト + Reactダッシュボード

## 概要
EV充電スタンド情報サイト「GOGOEV」から、故障情報とメンテナンス情報を自動収集し、CSV形式とJSON形式で出力するPythonスクリプトです。さらに、Reactで構築されたダッシュボードでデータを視覚的に表示・管理できます。

## 機能
- 故障情報（https://ev.gogo.gs/accident）の自動収集
- メンテナンス情報（https://ev.gogo.gs/maintenance）の自動収集
- 各施設の詳細ページから追加情報（住所、充電タイプ、出力、充電器数、メーカー）を取得
- CSV形式での出力（utf-8-sigエンコーディング）
- JSON形式での出力（Reactダッシュボード用）
- FastAPIサーバーによるAPI化
- Reactダッシュボードによるデータの視覚化と管理

## 必要な環境
- Python 3.7以上
- Node.js 18以上（Reactダッシュボード用）

## インストール方法

### Python側（バックエンド）

1. 必要なパッケージをインストール:
```bash
pip install -r requirements.txt
```

### React側（フロントエンド）

1. Reactプロジェクトディレクトリに移動:
```bash
cd ev-charger-dashboard
```

2. 必要なパッケージをインストール（既にインストール済みの場合はスキップ）:
```bash
npm install
```

## 使用方法

### 方法1: コマンドラインから直接実行

```bash
python ev_scraper.py
```

スクリプトを実行すると、以下の処理が行われます：
1. 故障情報一覧ページから施設情報を取得
2. メンテナンス情報一覧ページから施設情報を取得
3. 各施設の詳細ページにアクセスして追加情報を取得
4. すべての情報を統合して `ev_status_list.csv` と `public/data.json` に出力

### 方法2: Reactダッシュボードから実行（推奨）

#### Windowsの場合（バッチファイルを使用）

**最も簡単な方法**: `start_servers.bat` をダブルクリックするだけです。

このバッチファイルは、FastAPIサーバーとReact開発サーバーの両方を自動的に起動します。

**個別に起動する場合**:
- `start_fastapi.bat` - FastAPIサーバーのみ起動
- `start_react.bat` - React開発サーバーのみ起動
- `stop_servers.bat` - すべてのサーバーを停止

#### 手動で起動する場合

1. **FastAPIサーバーを起動**（ターミナル1）:
```bash
python api_server.py
```
サーバーは `http://localhost:8000` で起動します。

2. **React開発サーバーを起動**（ターミナル2）:
```bash
cd ev-charger-dashboard
npm run dev
```
ダッシュボードは `http://localhost:5173` で起動します。

3. **ブラウザでダッシュボードを開く**:
   - ブラウザで `http://localhost:5173` にアクセス
   - 「最新データを取得」ボタンをクリックしてデータ収集を開始
   - 収集が完了すると、自動的にデータが表示されます

## 出力ファイル

### CSV形式
`ev_status_list.csv` に以下のカラムでデータが保存されます：

- 更新日
- 施設名
- 都道府県
- 住所
- 種別（故障/メンテナンス）
- 詳細内容
- 充電タイプ
- 出力
- 充電器数
- メーカー
- 詳細URL

### JSON形式
`public/data.json` にReactダッシュボード用のJSON形式でデータが保存されます（orient='records'形式）。

## Reactダッシュボードの機能

- **データ表示**: カード形式で施設情報を一覧表示
- **フィルタリング**: 「すべて」「故障のみ」「メンテナンスのみ」でフィルタリング
- **検索機能**: 施設名、住所、都道府県で検索
- **Google Maps連携**: 住所をクリックするとGoogle Mapsが開く
- **リアルタイム更新**: データ収集完了後、自動的に最新データを表示
- **レスポンシブ対応**: スマートフォンでも見やすいデザイン

## 注意事項

- サーバー負荷を軽減するため、リクエスト間に適切な待機時間を設定しています
- 詳細ページの取得に時間がかかる場合があります（1施設あたり約1.5秒）
- ネットワークエラーやページ構造の変更により、一部のデータが取得できない場合があります
- 取得したデータは最新の情報を反映しているとは限りません

## APIエンドポイント

FastAPIサーバーは以下のエンドポイントを提供します：

- `GET /`: APIの状態を確認
- `POST /run-scrape`: スクレイピングを実行
- `GET /health`: ヘルスチェック

## エラーハンドリング

- ページ取得に失敗した場合、その施設をスキップして処理を続行します
- 要素が見つからない場合、空文字列が設定されます
- APIエラーが発生した場合、Reactダッシュボードにエラーメッセージが表示されます

## トラブルシューティング

### FastAPIサーバーに接続できない場合
- サーバーが起動しているか確認してください（`python api_server.py`）
- ポート8000が使用可能か確認してください

### Reactダッシュボードでデータが表示されない場合
- `public/data.json` ファイルが存在するか確認してください
- ブラウザのコンソールでエラーを確認してください
- データ収集を実行してJSONファイルを生成してください
